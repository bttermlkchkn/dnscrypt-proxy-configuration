# ------------------------------
# dnscrypt-proxy 2.x â€” Production Configuration
# IPv6-first, IPv4-fallback, anonymized, resilient
# Generated on 2026-01-08 for long-term "never touch again" deployment
# ------------------------------

# --- [1] LOCAL LISTENING ---
# Listen on standard DNS port (53) for seamless NetworkManager integration
listen_addresses = ['127.0.0.1:53', '[::1]:53']
max_clients = 250

# --- [2] PROTOCOL PREFERENCE ---
ipv4_servers = true   # Keep as fallback
ipv6_servers = true   # Primary path
dnscrypt_servers = true
doh_servers = false
odoh_servers = false

# --- [3] SERVER SELECTION â€” IPv6-first, fallback to IPv4 ---
# Prioritize IPv6-capable, DNSSEC + nolog servers in CH/DE/FR
# Mixed filtering (Quad9) + non-filtering (dct-*, brahma-world) for balance
server_names = [
  # âœ… IPv6 + filtering (Quad9 â€” malware/phishing blocked)
  'quad9-dnscrypt-ip6-filter-pri',
  'quad9-dnscrypt-ip6-filter-alt',

  # âœ… IPv6 + non-filtering (Germany, Switzerland, France)
  'brahma-world-ipv6',         # Nuremberg, DE â€” nolog, DNSSEC, adblock
  'dnscrypt.uk-ipv6',          # London, UK â€” nolog, uncensored, DNSSEC
  'v.dnscrypt.uk-ipv6',        # London, UK â€” backup
  'scaleway-fr-ipv6',          # Paris, FR â€” nolog, DNSSEC, uncensored
  'scaleway-ams-ipv6',         # Amsterdam, NL â€” nolog, DNSSEC

  # ðŸ”„ IPv4 fallbacks (only used if IPv6 path fails)
  'quad9-dnscrypt-ip4-filter-pri',
  'quad9-dnscrypt-ip4-filter-alt',
  'dct-de',                    # Berlin, DE â€” nolog, DNSSEC
  'dct-fr',                    # Paris, FR â€” nolog, DNSSEC
  'digitalprivacy.diy-dnscrypt-ipv4',  # Nuremberg, DE â€” nolog, DNSSEC
]

# --- [4] STRICT REQUIREMENTS ---
require_dnssec = true
require_nolog = true
require_nofilter = false   # Allow Quad9 filtering for protection
# (Set to `true` if you *never* want filtering â€” but then remove Quad9)

# --- [5] BOOTSTRAP & FALLBACK RESILIENCE ---
# Multiple diverse, reliable bootstrap DNS â€” IPv6 preferred
bootstrap_resolvers = [
  # IPv6 (preferred)
  '[2620:fe::fe]:53',          # Quad9 IPv6
  '[2001:620:0:ff::2]:53',     # SWITCH CH IPv6
  '[2a05:fc84::42]:53',        # Digital Society ZÃ¼rich IPv6

  # IPv4 (fallback)
  '9.9.9.9:53',                # Quad9 IPv4
  '130.59.31.248:53',          # SWITCH CH IPv4
  '185.95.218.42:53',          # Digital Society ZÃ¼rich IPv4
  '1.1.1.1:53',                # Cloudflare (last-resort, non-filtering)
]

ignore_system_dns = true
netprobe_address = '[2620:fe::fe]:53'  # IPv6 net health check
netprobe_timeout = 10

# --- [6] CACHING ---
cache = true
cache_size = 8192
cache_min_ttl = 1800   # 30 min
cache_max_ttl = 86400  # 24h

# --- [7] ANONYMIZED DNS â€” IPv6 relay chain first, IPv4 only as last resort ---
[anonymized_dns]
skip_incompatible = true
routes = [
  { server_name = '*', via = [
    # ðŸŸ¢ IPv6-Only Relays (Privacy++ â€” no IPv4 leakage)
    'anon-scaleway-ipv6',        # FR â€” Frank Denis
    'anon-scaleway-ams-ipv6',    # NL â€” Amsterdam
    'anon-dnscrypt.uk-ipv6',     # UK â€” London
    'anon-v.dnscrypt.uk-ipv6',   # UK â€” Vultr (backup)

    # ðŸŸ¡ IPv6+IPv4 Hybrid (if pure IPv6 fails)
    'anon-cs-de',                # Frankfurt â€” cryptostorm (IPv4, but EU)
    'anon-cs-fr',                # France â€” cryptostorm
    'anon-cs-ch',                # Switzerland â€” cryptostorm (your fave ðŸ‡¨ðŸ‡­)

    # ðŸ”´ IPv4-Only (absolute last resort â€” e.g., if IPv6 broken entirely)
    'anon-digitalprivacy.diy-ipv4',  # Nuremberg, DE â€” your trusted DIY relay
    'anon-kama',                 # FR â€” Frank Denis (IPv4)
  ] }
]

# --- [8] SOURCES â€” Auto-refresh, signed, multiple mirrors ---
[sources.quad9-resolvers]
urls = [
  "https://quad9.net/dnscrypt/quad9-resolvers.md",
  "https://raw.githubusercontent.com/Quad9DNS/dnscrypt-settings/main/dnscrypt/quad9-resolvers.md"
]
minisign_key = "RWTp2E4t64BrL651lEiDLNon+DqzPG4jhZ97pfdNkcq1VDdocLKvl5FW"
cache_file = "quad9-resolvers.md"
refresh_delay = 72
prefix = "quad9-"

[sources.public-resolvers]
urls = [
  "https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/public-resolvers.md",
  "https://download.dnscrypt.info/resolvers-list/v3/public-resolvers.md"
]
minisign_key = "RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3"
cache_file = "public-resolvers.md"
refresh_delay = 71

[sources.relays]
urls = [
  "https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/relays.md",
  "https://download.dnscrypt.info/resolvers-list/v3/relays.md"
]
minisign_key = "RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3"
cache_file = "relays.md"
refresh_delay = 71
